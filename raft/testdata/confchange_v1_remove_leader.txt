# We'll turn this back on after the boilerplate.
log-level none
----
ok

# Run a V1 membership change that removes the leader.
# Bootstrap n1, n2, n3.
add-nodes 3 voters=(1,2,3) index=2
----
ok

campaign 1
----
ok

stabilize
----
ok (quiet)

log-level debug
----
ok

# Remove n1.
propose-conf-change 1 v1=true
r1
----
ok

stabilize
----
> 1 handling Ready
  Ready MustSync=true:
  Entries:
  1/4 EntryConfChange r1
  Messages:
  1->2 MsgApp Term:1 Log:1/3 Commit:3 Entries:[1/4 EntryConfChange r1]
  1->3 MsgApp Term:1 Log:1/3 Commit:3 Entries:[1/4 EntryConfChange r1]
> 2 receiving messages
  1->2 MsgApp Term:1 Log:1/3 Commit:3 Entries:[1/4 EntryConfChange r1]
> 3 receiving messages
  1->3 MsgApp Term:1 Log:1/3 Commit:3 Entries:[1/4 EntryConfChange r1]
> 2 handling Ready
  Ready MustSync=true:
  Entries:
  1/4 EntryConfChange r1
  Messages:
  2->1 MsgAppResp Term:1 Log:0/4
> 3 handling Ready
  Ready MustSync=true:
  Entries:
  1/4 EntryConfChange r1
  Messages:
  3->1 MsgAppResp Term:1 Log:0/4
> 1 receiving messages
  2->1 MsgAppResp Term:1 Log:0/4
  3->1 MsgAppResp Term:1 Log:0/4
> 1 handling Ready
  INFO 1 switched to configuration voters=(2 3)
  Ready MustSync=false:
  HardState Term:1 Vote:1 Commit:4
  CommittedEntries:
  1/4 EntryConfChange r1
  Messages:
  1->2 MsgApp Term:1 Log:1/4 Commit:4
  1->3 MsgApp Term:1 Log:1/4 Commit:4
> 2 receiving messages
  1->2 MsgApp Term:1 Log:1/4 Commit:4
> 3 receiving messages
  1->3 MsgApp Term:1 Log:1/4 Commit:4
> 2 handling Ready
  INFO 2 switched to configuration voters=(2 3)
  Ready MustSync=false:
  HardState Term:1 Vote:1 Commit:4
  CommittedEntries:
  1/4 EntryConfChange r1
  Messages:
  2->1 MsgAppResp Term:1 Log:0/4
> 3 handling Ready
  INFO 3 switched to configuration voters=(2 3)
  Ready MustSync=false:
  HardState Term:1 Vote:1 Commit:4
  CommittedEntries:
  1/4 EntryConfChange r1
  Messages:
  3->1 MsgAppResp Term:1 Log:0/4
> 1 receiving messages
  2->1 MsgAppResp Term:1 Log:0/4
  3->1 MsgAppResp Term:1 Log:0/4

status 1
----
2: StateReplicate match=4 next=5
3: StateReplicate match=4 next=5

# TODO(tbg): the leader now drops any proposals, but if it has any other
# uncommitted proposals in its log already, it will likely try to distribute
# them which could be buggy. Test that.
propose-conf-change 1 v1=true
v1
----
raft proposal dropped
